<!doctype html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Image Generator</title>
    <style>
      body{font-family:Arial,Helvetica,sans-serif;margin:24px}
      label{display:block;margin-top:8px}
      input[type=text],select{width:100%;padding:8px;margin-top:4px}
      button{margin-top:12px;padding:8px 12px}
      .thumb{max-width:240px;margin:8px}
      .results{margin-top:16px}
      .log{white-space:pre-wrap;background:#f6f6f6;padding:8px;border-radius:4px}
    </style>
  </head>
  <body>
    <h1>Image Generator</h1>
    <form id="form">
      <label>Prompt
        <input type="text" id="prompt" required placeholder="A fantasy castle on a hill at sunrise" />
      </label>
      <label>Size
        <select id="size">
          <option selected>1024x1024</option>
          <option>1024x1536</option>
          <option>1536x1024</option>
          <option>auto</option>
        </select>
      </label>
      <label>Count
        <input type="number" id="count" min="1" max="10" value="1" />
      </label>
      <button type="submit">Generate</button>
    </form>

    <div class="results" id="results"></div>
    <h3>Logs</h3>
    <div class="log" id="log"></div>

    <script>
      const form = document.getElementById('form');
      const results = document.getElementById('results');
      const log = document.getElementById('log');

      form.addEventListener('submit', async (e) => {
        e.preventDefault();
        results.innerHTML = '';
        log.textContent = 'Generating...';
        const prompt = document.getElementById('prompt').value;
        const size = document.getElementById('size').value;
        const count = document.getElementById('count').value;

        try {
          const res = await fetch('/generate', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ prompt, size, count })
          });
          const data = await res.json();
          if (!res.ok) throw data;

          log.textContent = (data.stdout || '') + '\n' + (data.stderr || '');
          if (data.files && data.files.length) {
            for (const f of data.files) {
              const img = document.createElement('img');
              img.src = f;
              img.className = 'thumb';
              results.appendChild(img);
            }
          } else {
            results.textContent = 'No images returned';
          }
        } catch (err) {
          log.textContent = JSON.stringify(err, null, 2);
        }
      });
    </script>
  </body>
</html>
